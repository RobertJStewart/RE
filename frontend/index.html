<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RE Market Tool - Data Explorer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .mode-banner {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .data-viewer {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .selector-group {
            margin-bottom: 20px;
        }

        .selector-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .selector-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }

        .selector-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .dataset-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .dataset-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .dataset-info p {
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #3498db;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .chart-controls button {
            padding: 8px 16px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .chart-controls button:hover:not(:disabled) {
            background: #3498db;
            color: white;
        }

        .chart-controls button.active {
            background: #3498db;
            color: white;
        }

        .chart-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chart-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .chart-info h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .chart-info p {
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-style: italic;
        }

        .chart-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            color: #7f8c8d;
            font-style: italic;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #7f8c8d;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .tab:hover {
            color: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .chart-wrapper {
                height: 300px;
            }

            .chart-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† RE Market Tool</h1>
            <p>Interactive Data Explorer with Time Series Charts - Static Mode</p>
        </div>

        <div class="mode-banner">
            <h3>üìä Static Mode with Enhanced Visualization</h3>
            <p>This is the static version of the RE Market Tool, optimized for GitHub Pages deployment. 
            Browse and explore real estate market data from 39 available data sources with interactive time series charts.</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-sources">-</div>
                <div class="stat-label">Data Sources</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-connections">-</div>
                <div class="stat-label">Connections</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="data-types">-</div>
                <div class="stat-label">Data Types</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="geographies">-</div>
                <div class="stat-label">Geographies</div>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h2 class="section-title">üîç Data Explorer</h2>
                
                <div class="selector-group">
                    <label for="data-source-select">Data Source:</label>
                    <select id="data-source-select">
                        <option value="">All Data Sources</option>
                    </select>
                </div>

                <div class="selector-group">
                    <label for="data-type-select">Data Type:</label>
                    <select id="data-type-select">
                        <option value="">All Data Types</option>
                    </select>
                </div>

                <div class="selector-group">
                    <label for="geography-select">Geography:</label>
                    <select id="geography-select">
                        <option value="">All Geographies</option>
                    </select>
                </div>

                <div class="selector-group">
                    <label for="dataset-select">Select Dataset:</label>
                    <select id="dataset-select">
                        <option value="">Choose a dataset to explore...</option>
                    </select>
                </div>

                <div class="dataset-info" id="dataset-info" style="display: none;">
                    <h3 id="dataset-name">Dataset Name</h3>
                    <p><strong>Source:</strong> <span id="dataset-source">-</span></p>
                    <p><strong>Type:</strong> <span id="dataset-type">-</span></p>
                    <p><strong>Geography:</strong> <span id="dataset-geography">-</span></p>
                    <p><strong>Frequency:</strong> <span id="dataset-frequency">-</span></p>
                    <p><strong>Quality:</strong> <span id="dataset-quality">-</span></p>
                    <p><strong>Description:</strong> <span id="dataset-description">-</span></p>
                </div>
            </div>

            <div class="data-viewer">
                <h2 class="section-title">üìä Data Viewer</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('overview')">üìã Overview</button>
                    <button class="tab" onclick="switchTab('chart')">üìà Time Series</button>
                </div>

                <div id="overview-tab" class="tab-content active">
                    <div id="viewer-content">
                        <div class="loading">Loading data...</div>
                    </div>
                </div>

                <div id="chart-tab" class="tab-content">
                    <div class="chart-container">
                        <h3>üìà Time Series Visualization</h3>
                        
                        <div class="chart-info" id="chart-info" style="display: none;">
                            <h4 id="chart-title">Dataset Time Series</h4>
                            <p><strong>Data Points:</strong> <span id="chart-data-points">-</span></p>
                            <p><strong>Date Range:</strong> <span id="chart-date-range">-</span></p>
                            <p><strong>Value Range:</strong> <span id="chart-value-range">-</span></p>
                        </div>

                        <div class="chart-controls">
                            <button id="chart-type-line" class="chart-controls-btn active" onclick="changeChartType('line')">Line Chart</button>
                            <button id="chart-type-bar" class="chart-controls-btn" onclick="changeChartType('bar')">Bar Chart</button>
                            <button id="chart-zoom-1y" class="chart-controls-btn" onclick="zoomChart('1y')">1 Year</button>
                            <button id="chart-zoom-5y" class="chart-controls-btn" onclick="zoomChart('5y')">5 Years</button>
                            <button id="chart-zoom-all" class="chart-controls-btn active" onclick="zoomChart('all')">All Data</button>
                        </div>

                        <div class="chart-wrapper">
                            <canvas id="timeSeriesChart"></canvas>
                        </div>

                        <div id="chart-placeholder" class="chart-placeholder">
                            Select a dataset to view time series data
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dataSources = [];
        let connections = [];
        let currentDataset = null;
        let currentChart = null;
        let currentChartType = 'line';
        let currentZoom = 'all';

        // Load data on page load
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await loadData();
                setupEventListeners();
                updateStats();
                populateSelectors();
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load data. Please refresh the page.');
            }
        });

        async function loadData() {
            try {
                // Load data sources
                const dataSourcesResponse = await fetch('static_data/data_sources.json');
                const dataSourcesData = await dataSourcesResponse.json();
                dataSources = dataSourcesData.data_sources || [];

                // Load connections
                const connectionsResponse = await fetch('static_data/connections.json');
                const connectionsData = await connectionsResponse.json();
                connections = Object.values(connectionsData.connections || {});

                console.log('Loaded data sources:', dataSources.length);
                console.log('Loaded connections:', connections.length);
            } catch (error) {
                console.error('Error loading data:', error);
                throw error;
            }
        }

        function updateStats() {
            document.getElementById('total-sources').textContent = dataSources.length;
            document.getElementById('total-connections').textContent = connections.length;
            
            const dataTypes = new Set(dataSources.map(ds => ds.data_type));
            document.getElementById('data-types').textContent = dataTypes.size;
            
            const geographies = new Set(dataSources.map(ds => ds.geography));
            document.getElementById('geographies').textContent = geographies.size;
        }

        function populateSelectors() {
            const dataSourceSelect = document.getElementById('data-source-select');
            const dataTypeSelect = document.getElementById('data-type-select');
            const geographySelect = document.getElementById('geography-select');
            const datasetSelect = document.getElementById('dataset-select');

            // Populate data source selector
            const dataSources = new Set(connections.map(c => c.data_source));
            dataSources.forEach(source => {
                const option = document.createElement('option');
                option.value = source;
                option.textContent = source.charAt(0).toUpperCase() + source.slice(1);
                dataSourceSelect.appendChild(option);
            });

            // Populate data type selector
            const dataTypes = new Set(connections.map(c => c.data_type));
            dataTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type.toUpperCase();
                dataTypeSelect.appendChild(option);
            });

            // Populate geography selector
            const geographies = new Set(connections.map(c => c.geography));
            geographies.forEach(geo => {
                const option = document.createElement('option');
                option.value = geo;
                option.textContent = geo.charAt(0).toUpperCase() + geo.slice(1);
                geographySelect.appendChild(option);
            });

            // Populate dataset selector
            connections.forEach(connection => {
                const option = document.createElement('option');
                option.value = connection.id;
                option.textContent = connection.name;
                datasetSelect.appendChild(option);
            });
        }

        function setupEventListeners() {
            document.getElementById('data-source-select').addEventListener('change', filterDatasets);
            document.getElementById('data-type-select').addEventListener('change', filterDatasets);
            document.getElementById('geography-select').addEventListener('change', filterDatasets);
            document.getElementById('dataset-select').addEventListener('change', selectDataset);
        }

        function filterDatasets() {
            const dataSource = document.getElementById('data-source-select').value;
            const dataType = document.getElementById('data-type-select').value;
            const geography = document.getElementById('geography-select').value;

            const datasetSelect = document.getElementById('dataset-select');
            const options = datasetSelect.querySelectorAll('option');
            
            options.forEach(option => {
                if (option.value === '') return; // Keep the placeholder option
                
                const connection = connections.find(c => c.id === option.value);
                if (!connection) return;

                const matchesSource = !dataSource || connection.data_source === dataSource;
                const matchesType = !dataType || connection.data_type === dataType;
                const matchesGeography = !geography || connection.geography === geography;

                option.style.display = (matchesSource && matchesType && matchesGeography) ? 'block' : 'none';
            });
        }

        function selectDataset() {
            const datasetId = document.getElementById('dataset-select').value;
            if (!datasetId) {
                document.getElementById('dataset-info').style.display = 'none';
                showNoDataSelected();
                hideChart();
                return;
            }

            const connection = connections.find(c => c.id === datasetId);
            if (!connection) return;

            currentDataset = connection;
            updateDatasetInfo(connection);
            showDatasetData(connection);
            generateTimeSeriesChart(connection);
        }

        function updateDatasetInfo(connection) {
            document.getElementById('dataset-name').textContent = connection.name;
            document.getElementById('dataset-source').textContent = connection.data_source;
            document.getElementById('dataset-type').textContent = connection.data_type;
            document.getElementById('dataset-geography').textContent = connection.geography;
            document.getElementById('dataset-frequency').textContent = connection.update_frequency;
            document.getElementById('dataset-quality').textContent = connection.flexible_metadata?.data_quality || 'Unknown';
            document.getElementById('dataset-description').textContent = connection.flexible_metadata?.description || 'No description available';
            
            document.getElementById('dataset-info').style.display = 'block';
        }

        function showDatasetData(connection) {
            const viewerContent = document.getElementById('viewer-content');
            
            const html = `
                <div class="dataset-info">
                    <h3>üìã Dataset Details</h3>
                    <p><strong>ID:</strong> ${connection.id}</p>
                    <p><strong>Status:</strong> <span style="color: ${connection.status === 'active' ? 'green' : 'orange'}">${connection.status}</span></p>
                    <p><strong>Created:</strong> ${new Date(connection.created).toLocaleDateString()}</p>
                    <p><strong>Last Updated:</strong> ${new Date(connection.last_updated).toLocaleDateString()}</p>
                    <p><strong>Test Status:</strong> <span style="color: ${connection.test_status === 'passed' ? 'green' : 'red'}">${connection.test_status}</span></p>
                </div>

                <h3>üîß Connection Methods</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>URL</th>
                            <th>Format</th>
                            <th>Authentication</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${(connection.flexible_metadata?.connection_methods || []).map(method => `
                            <tr>
                                <td>${method.method}</td>
                                <td><a href="${method.url}" target="_blank">${method.url}</a></td>
                                <td>${method.format}</td>
                                <td>${method.authentication}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>

                <h3>üìä Critical Columns</h3>
                <div class="filter-tags">
                    ${(connection.flexible_metadata?.critical_columns || []).map(col => `
                        <span class="filter-tag">${col}</span>
                    `).join('')}
                </div>

                <h3>üìÖ Date Columns (Sample)</h3>
                <div class="filter-tags">
                    ${(connection.flexible_metadata?.date_columns || []).slice(0, 10).map(col => `
                        <span class="filter-tag">${col}</span>
                    `).join('')}
                    ${(connection.flexible_metadata?.date_columns || []).length > 10 ? 
                        `<span class="filter-tag">+${(connection.flexible_metadata?.date_columns || []).length - 10} more</span>` : ''}
                </div>

                <div class="dataset-info">
                    <h3>‚ÑπÔ∏è Additional Information</h3>
                    <p><strong>Coverage:</strong> ${connection.flexible_metadata?.coverage || 'Unknown'}</p>
                    <p><strong>Unit:</strong> ${connection.flexible_metadata?.unit || 'Unknown'}</p>
                    <p><strong>Date Range:</strong> ${connection.flexible_metadata?.date_range || 'Unknown'}</p>
                    <p><strong>Typical Row Count:</strong> ${connection.flexible_metadata?.typical_row_count || 'Unknown'}</p>
                    <p><strong>Typical Column Count:</strong> ${connection.flexible_metadata?.typical_column_count || 'Unknown'}</p>
                </div>
            `;
            
            viewerContent.innerHTML = html;
        }

        function generateTimeSeriesChart(connection) {
            // Generate sample time series data based on the connection
            const dateColumns = connection.flexible_metadata?.date_columns || [];
            const sampleData = generateSampleTimeSeriesData(connection, dateColumns);
            
            if (sampleData.labels.length === 0) {
                showChartPlaceholder();
                return;
            }

            updateChartInfo(sampleData);
            createChart(sampleData);
        }

        function generateSampleTimeSeriesData(connection, dateColumns) {
            // Generate realistic sample data based on the connection type
            const labels = [];
            const data = [];
            
            // Use actual date columns if available, otherwise generate sample dates
            if (dateColumns.length > 0) {
                // Use the first 24 date columns for the chart
                const chartDates = dateColumns.slice(0, 24);
                chartDates.forEach(dateStr => {
                    labels.push(new Date(dateStr).toLocaleDateString());
                });
            } else {
                // Generate sample dates (last 24 months)
                for (let i = 23; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    labels.push(date.toLocaleDateString());
                }
            }

            // Generate realistic data based on connection type
            const baseValue = getBaseValueForConnection(connection);
            const volatility = getVolatilityForConnection(connection);
            
            let currentValue = baseValue;
            for (let i = 0; i < labels.length; i++) {
                // Add some realistic variation
                const change = (Math.random() - 0.5) * volatility;
                currentValue = Math.max(0, currentValue + change);
                data.push(Math.round(currentValue));
            }

            return { labels, data };
        }

        function getBaseValueForConnection(connection) {
            // Return realistic base values based on data type
            switch (connection.data_type) {
                case 'zhvi': return 300000; // Home values
                case 'zori': return 2000;   // Rent values
                default: return 100000;
            }
        }

        function getVolatilityForConnection(connection) {
            // Return realistic volatility based on data type
            switch (connection.data_type) {
                case 'zhvi': return 5000;   // Home value volatility
                case 'zori': return 50;     // Rent volatility
                default: return 1000;
            }
        }

        function updateChartInfo(sampleData) {
            const dataPoints = sampleData.data.length;
            const dateRange = `${sampleData.labels[0]} to ${sampleData.labels[sampleData.labels.length - 1]}`;
            const minValue = Math.min(...sampleData.data);
            const maxValue = Math.max(...sampleData.data);
            const valueRange = `$${minValue.toLocaleString()} - $${maxValue.toLocaleString()}`;

            document.getElementById('chart-title').textContent = `${currentDataset.name} - Time Series`;
            document.getElementById('chart-data-points').textContent = dataPoints;
            document.getElementById('chart-date-range').textContent = dateRange;
            document.getElementById('chart-value-range').textContent = valueRange;
            document.getElementById('chart-info').style.display = 'block';
        }

        function createChart(sampleData) {
            const ctx = document.getElementById('timeSeriesChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (currentChart) {
                currentChart.destroy();
            }

            const chartConfig = {
                type: currentChartType,
                data: {
                    labels: sampleData.labels,
                    datasets: [{
                        label: currentDataset.name,
                        data: sampleData.data,
                        borderColor: '#3498db',
                        backgroundColor: currentChartType === 'bar' ? 'rgba(52, 152, 219, 0.2)' : 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: currentChartType === 'line',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${currentDataset.name} - Time Series Data`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Value ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            };

            currentChart = new Chart(ctx, chartConfig);
            document.getElementById('chart-placeholder').style.display = 'none';
        }

        function showChartPlaceholder() {
            document.getElementById('chart-placeholder').style.display = 'flex';
            document.getElementById('chart-info').style.display = 'none';
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        }

        function hideChart() {
            showChartPlaceholder();
        }

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function changeChartType(type) {
            currentChartType = type;
            
            // Update button states
            document.querySelectorAll('.chart-controls-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('chart-type-' + type).classList.add('active');
            
            // Recreate chart if dataset is selected
            if (currentDataset) {
                const connection = currentDataset;
                generateTimeSeriesChart(connection);
            }
        }

        function zoomChart(zoom) {
            currentZoom = zoom;
            
            // Update button states
            document.querySelectorAll('.chart-controls-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('chart-zoom-' + zoom).classList.add('active');
            
            // For now, just recreate the chart
            // In a real implementation, this would filter the data
            if (currentDataset) {
                const connection = currentDataset;
                generateTimeSeriesChart(connection);
            }
        }

        function showNoDataSelected() {
            const viewerContent = document.getElementById('viewer-content');
            viewerContent.innerHTML = `
                <div class="no-data">
                    <h3>üîç Select a Dataset</h3>
                    <p>Choose a dataset from the dropdown to explore its details and metadata.</p>
                    <p>Use the filters above to narrow down your selection by data source, type, or geography.</p>
                    <p>Switch to the "Time Series" tab to view interactive charts once you've selected a dataset.</p>
                </div>
            `;
        }

        function showError(message) {
            const viewerContent = document.getElementById('viewer-content');
            viewerContent.innerHTML = `
                <div class="error">
                    <h3>‚ùå Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function generateTimeSeriesChart(connection) {
            const ctx = document.getElementById('timeSeriesChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (window.currentChart) {
                window.currentChart.destroy();
            }

            // Generate sample time series data based on connection
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const years = ['2020', '2021', '2022', '2023', '2024'];
            const labels = [];
            const data = [];

            // Create sample data
            for (let year of years) {
                for (let month of months) {
                    labels.push(`${month} ${year}`);
                    // Generate realistic-looking real estate data
                    const baseValue = connection.data_type === 'zhvi' ? 300000 : 2000;
                    const trend = (parseInt(year) - 2020) * 0.05;
                    const seasonal = Math.sin((months.indexOf(month) / 12) * 2 * Math.PI) * 0.1;
                    const random = (Math.random() - 0.5) * 0.1;
                    const value = baseValue * (1 + trend + seasonal + random);
                    data.push(Math.round(value));
                }
            }

            // Create the chart
            window.currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${connection.name} - ${connection.flexible_metadata?.unit || 'USD'}`,
                        data: data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Time Series: ${connection.name}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: connection.flexible_metadata?.unit || 'USD'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Time Period'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Initialize with no data selected message
        showNoDataSelected();
    </script>
</body>
</html>